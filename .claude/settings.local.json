{
  "permissions": {
    "allow": [
      "Bash(gh auth status:*)",
      "Bash(git init:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(gh repo create:*)",
      "Bash(gh issue create:*)",
      "Bash(gh label create:*)",
      "Bash(gh issue list:*)",
      "Bash(dotnet new:*)",
      "Bash(dotnet sln add:*)",
      "Bash(dotnet add:*)",
      "Bash(dotnet build:*)",
      "Bash(git push)",
      "Bash(gh issue close:*)",
      "Bash(git push:*)",
      "Bash(Get-ChildItem \"C:\\ClaudeCode\\Projects\\Pokemons\\src\\PokemonRedAI.Web\\bin\\Release\\net8.0\\logs\" \" -ErrorAction SilentlyContinue)",
      "Bash(Select-Object -ExpandProperty FullName)",
      "Bash(ls -la \"C:\\ClaudeCode\\Projects\\Pokemons\\src\\PokemonRedAI.Web\\bin\\Release\\net8.0\\logs\"\" 2>/dev/null || ls -la \"C:ClaudeCodeProjectsPokemonssrcPokemonRedAI.WebbinDebugnet8.0logs\"\")",
      "Bash(find:*)",
      "Bash(dir:*)",
      "Bash(dotnet run:*)",
      "Bash(timeout 8 curl:*)",
      "Bash(start:*)",
      "Bash(gh issue create --title \"Phase 2: Battle State Handling\" --body \"$(cat <<''EOF''\n## Overview\nImplement battle state handling to allow the AI to advance through Pokemon battles. Initial implementation will use a simple strategy (select first move, advance through text).\n\n## Priority\nðŸ”´ **Critical** - Required for any gameplay beyond initial exploration.\n\n## Tasks\n\n### Step 2.1: Create Battle State Handler\n**File**: `src/PokemonRedAI.Core/State/BattleStateHandler.cs`\n\nBasic battle handling (v1 - advance through battles):\n```\n1. If text displayed â†’ Press A to advance\n2. If menu displayed â†’ Select first option (Fight)\n3. If move selection â†’ Select first move\n4. Repeat until battle ends\n```\n\n### Step 2.2: Battle Detection Specifics\n\n**Screen regions to analyze**:\n- **Enemy HP Bar**: Top area, ~Y: 16-32, X: 96-152\n- **Player HP Bar**: Bottom area, ~Y: 72-88, X: 96-152\n- **Battle Menu**: Bottom box with \"FIGHT/PKMN/ITEM/RUN\"\n- **Move Menu**: 4 move options in selection box\n\n**Detection heuristics**:\n- HP bars have specific green (#00FF00), yellow (#FFFF00), red (#FF0000) colors\n- Battle background differs from overworld (usually solid color or pattern)\n- Enemy Pokemon sprite in top-left area\n\n### Step 2.3: Battle Action Logic\n\nImplement battle phase detection and appropriate responses:\n```\nBattlePhase detection:\nâ”œâ”€â”€ TEXT_DISPLAY â†’ Press A\nâ”œâ”€â”€ MAIN_MENU (Fight/PKMN/Item/Run visible) â†’ Navigate to FIGHT, press A\nâ”œâ”€â”€ MOVE_SELECTION (4 moves visible) â†’ Press A on first move\nâ”œâ”€â”€ ANIMATION â†’ Wait\nâ””â”€â”€ UNKNOWN â†’ Press B (try to exit/cancel)\n```\n\n### Step 2.4: Battle End Detection\n\nDetect when battle has ended:\n- Screen transitions back to overworld\n- \"Gained X EXP\" text appears\n- Pokemon faints message\n- Wild Pokemon fled\n\n## Acceptance Criteria\n- [ ] `BattleStateHandler` class created\n- [ ] Battle phase detection (text, menu, move selection, animation)\n- [ ] AI selects Fight â†’ First move automatically\n- [ ] AI advances through all battle text\n- [ ] AI successfully completes wild Pokemon encounters\n- [ ] Battle end detection returns control to overworld handling\n\n## Technical Notes\n- HP bar colors: Green (#00FF00 range), Yellow (#FFFF00 range), Red (#FF0000 range)\n- Battle menu is always in a fixed position at screen bottom\n- Move selection replaces battle menu in same location\n- Consider animation frame detection to avoid input during animations\n\n## Dependencies\n- #16 Phase 1: Game State Detection System\n\n## Future Enhancements (Out of Scope)\n- Smart move selection based on type effectiveness\n- Item usage during battle\n- Pokemon switching strategy\n- Run from battles option\nEOF\n)\")",
      "Bash(gh issue create --title \"Phase 3: Menu State Handling\" --body \"$(cat <<''EOF''\n## Overview\nImplement menu state handling to detect when menus are open and exit them appropriately.\n\n## Priority\nðŸ”´ **Critical** - Prevents AI from getting stuck in accidentally opened menus.\n\n## Tasks\n\n### Step 3.1: Create Menu State Handler\n**File**: `src/PokemonRedAI.Core/State/MenuStateHandler.cs`\n\nMenu types to detect:\n- **Start Menu**: POKEDEX, POKEMON, ITEM, [player name], SAVE, OPTION, EXIT\n- **Pokemon Menu**: Party Pokemon list\n- **Item/Bag Menu**: Item listing\n- **Options Menu**: Game settings\n\n### Step 3.2: Menu Detection Patterns\n\n**Start Menu characteristics**:\n- Right-aligned box on screen\n- Dark background with white text\n- Specific menu item keywords\n\n**Sub-menu characteristics**:\n- Usually full or partial screen overlay\n- Selection cursor (â–º) visible\n- Specific layout patterns\n\n### Step 3.3: Menu Navigation Logic\n\nFor v1, implement simple exit strategy:\n```csharp\npublic async Task HandleMenu()\n{\n    int attempts = 0;\n    const int maxAttempts = 5;\n    \n    while (IsInMenu() && attempts < maxAttempts)\n    {\n        await SendButton(GameButton.B);\n        await Task.Delay(200);\n        attempts++;\n    }\n}\n```\n\n### Step 3.4: Menu State Tracking\n\nTrack menu depth to handle nested menus:\n- Start Menu â†’ Pokemon Menu â†’ Pokemon Details\n- Each B press should go back one level\n- Continue until returned to overworld\n\n## Acceptance Criteria\n- [ ] `MenuStateHandler` class created\n- [ ] Start menu detection working\n- [ ] Sub-menu detection working\n- [ ] AI exits menus within 5 B button presses\n- [ ] AI never gets stuck in menu state\n- [ ] Returns to overworld handling after menu exit\n\n## Technical Notes\n- Menu boxes have consistent border patterns\n- Selection cursor (â–º) helps identify active menu\n- Some menus have scrollable content\n- B button consistently exits/goes back in menus\n\n## Dependencies\n- #16 Phase 1: Game State Detection System\n\n## Future Enhancements (Out of Scope)\n- Purposeful menu navigation (heal Pokemon, use items)\n- Save game functionality\n- Pokemon team management via menu\n- Options configuration\nEOF\n)\")",
      "Bash(gh issue create --title \"Phase 4: Dialogue State Handling\" --body \"$(cat <<''EOF''\n## Overview\nImplement dialogue state handling to advance through NPC conversations, signs, and prompts.\n\n## Priority\nðŸ”´ **Critical** - Most common interruption during gameplay.\n\n## Tasks\n\n### Step 4.1: Create Dialogue Handler\n**File**: `src/PokemonRedAI.Core/State/DialogueStateHandler.cs`\n\n### Step 4.2: Dialogue Detection\n\nDetect text box characteristics:\n- White rectangle at bottom of screen\n- Spans full width (160px)\n- Height approximately 40px\n- Contains text (non-uniform pixel pattern inside box)\n- Black border around box\n\n### Step 4.3: Dialogue Indicator Detection\n\nDetect dialogue state indicators:\n\n| Indicator | Meaning | Action |\n|-----------|---------|--------|\n| **â–¼ (blinking down arrow)** | More text / Press to continue | Press A |\n| **â–º (selection arrow)** | Choice available | Navigate and select |\n| **No indicator, text visible** | Text still rendering | Wait |\n| **No indicator, text complete** | Dialogue may be ending | Press A |\n\n### Step 4.4: Dialogue Actions\n\n```csharp\npublic async Task HandleDialogue()\n{\n    if (HasContinueArrow())\n    {\n        await SendButton(GameButton.A);\n    }\n    else if (HasSelectionArrow())\n    {\n        // Default to first option (usually YES or positive response)\n        await SendButton(GameButton.A);\n    }\n    else if (IsTextRendering())\n    {\n        await Task.Delay(100); // Wait for text to finish\n    }\n    else\n    {\n        await SendButton(GameButton.A); // Try to advance\n    }\n}\n```\n\n### Step 4.5: Special Dialogue Handling\n\nHandle specific dialogue types:\n- **YES/NO prompts**: Default to YES (first option)\n- **Pokemon Center healing**: Advance through nurse dialogue\n- **Shop dialogue**: Exit with B (don''t buy anything)\n- **Name entry**: Handle or skip\n\n### Step 4.6: Dialogue End Detection\n\nDetect dialogue completion:\n- Text box disappears\n- Screen returns to overworld view\n- No more text indicators visible\n\n## Acceptance Criteria\n- [ ] `DialogueStateHandler` class created\n- [ ] Text box detection working\n- [ ] Continue arrow (â–¼) detection working\n- [ ] Selection arrow (â–º) detection working\n- [ ] AI advances through all dialogue automatically\n- [ ] AI handles YES/NO prompts (defaults to YES)\n- [ ] AI never gets stuck in dialogue\n- [ ] Returns to overworld handling after dialogue ends\n\n## Technical Notes\n- Text boxes have consistent positioning at screen bottom\n- Arrow indicators blink (toggle visible/hidden)\n- Text rendering takes time - don''t spam A too fast\n- Some dialogues have multiple pages\n\n## Dependencies\n- #16 Phase 1: Game State Detection System\n\n## Future Enhancements (Out of Scope)\n- Reading and understanding text content\n- Context-aware dialogue responses\n- Shop interaction (buying items)\n- Naming Pokemon/player\nEOF\n)\")",
      "Bash(gh issue edit:*)",
      "Bash(cat:*)",
      "Bash(gh issue view:*)"
    ]
  }
}
